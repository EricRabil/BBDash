const fs = require("fs");
const path = require("path");

const packages = fs.readdirSync(path.resolve(__dirname, "..", "packages"));

const rootNodeModules = path.resolve(__dirname, "../", "node_modules");
const packageNodeModules = package => path.resolve(__dirname, "../packages/", package, "node_modules");
const tmpModules = name => path.resolve("/tmp/bbdash_node_modules/", name + (name.length ? "_" : "") + "node_modules");

if (fs.existsSync(tmpModules(""))) {
    fs.renameSync(tmpModules(""), rootNodeModules);
}

for (const package of packages) {
    if (!fs.existsSync(packageNodeModules(package))) continue;
    fs.renameSync(tmpModules(package), packageNodeModules(package));
}