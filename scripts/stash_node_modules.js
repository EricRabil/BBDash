const fs = require("fs");
const path = require("path");

const packages = fs.readdirSync(path.resolve(__dirname, "..", "packages"));

fs.mkdirSync("/tmp/bbdash_node_modules", {
    recursive: true
});

const rootNodeModules = path.resolve(__dirname, "../", "node_modules");
const packageNodeModules = package => path.resolve(__dirname, "../packages/", package, "node_modules");
const tmpModules = name => path.resolve("/tmp/bbdash_node_modules/", name + (name.length ? "_" : "") + "node_modules");

if (fs.existsSync(rootNodeModules)) {
    fs.renameSync(rootNodeModules, tmpModules(""));
}

for (const package of packages) {
    if (!fs.existsSync(packageNodeModules(package))) continue;
    fs.renameSync(packageNodeModules(package), tmpModules(package));
}